{% load static %}
<!DOCTYPE html>
<html lang="en">
{% include 'expendable/head.html' %}

<body>
{% include 'expendable/navbar.html' %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Hero Section with Parallax Effect -->
<section class="section-hero overlay inner-page bg-image"
         style="background-image: url('{% static "images/hero_1.jpg" %}'); background-attachment: fixed;"
         id="home-section">
    <div class="container">
        <div class="row align-items-center justify-content-center text-center">
            <div class="col-md-8">
                <h1 class="text-white display-4 font-weight-bold">Edit Product</h1>
                <div class="custom-breadcrumbs">
                    <a href="{% url 'homepage' %}">Home</a> <span class="mx-2 slash">/</span>
                    <a href="{% url 'marketplace' %}">Products</a> <span class="mx-2 slash">/</span>
                    <span class="text-white"><strong>Edit {{ product.name }}</strong></span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Product Details Section -->
<div class="container my-5">
    <div class="row">
        <!-- Product Image Preview -->
        <div class="col-md-6 mb-4">
            <h4>Product Images</h4>
            <div id="imagePreview" class="mb-3">
                {% if product.images.all %}
                    {% for image in product.images.all %}
                        <img src="{{ image.image.url }}" class="img-fluid" style="max-height: 300px; object-fit: cover; margin-bottom: 10px;">
                    {% endfor %}
                {% else %}
                    <p>No images available.</p>
                {% endif %}
            </div>
            <input type="file" id="new_images" name="new_images" class="form-control" multiple>
        </div>

        <!-- Form Section -->
        <div class="col-md-6">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    <label for="name">Product Name</label>
                    <input type="text" id="name" name="name" class="form-control" value="{{ product.name }}" required>
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" class="form-control" rows="4" required>{{ product.description }}</textarea>
                </div>
                <div class="form-group">
                    <label for="price">Price</label>
                    <input type="number" id="price" name="price" class="form-control" value="{{ product.price }}" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="category">Category</label>
                    <input type="text" id="category" name="category" class="form-control" value="{{ product.category }}" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone</label>
                    <input type="text" id="phone" name="phone" class="form-control" value="{{ product.phone }}" required>
                </div>
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" name="location" class="form-control" value="{{ product.location }}" required>
                </div>
                <div class="form-group">
                    <label for="condition">Condition</label>
                    <input type="text" id="condition" name="condition" class="form-control" value="{{ product.condition }}" required>
                </div>
                <div class="form-group">
                    <label for="shipping_details">Shipping Method</label>
                    <input type="text" id="shipping_details" name="shipping_details" class="form-control" value="{{ product.shipping_details }}" required>
                </div>

                <button type="submit" class="btn btn-primary btn-lg">Update Product</button>
                <a href="{% url 'marketplace_my_post' %}" class="btn btn-secondary btn-lg ml-2">Cancel</a>
            </form>
        </div>
    </div>
</div>

<!-- Footer -->
{% include 'expendable/footer.html' %}

<!-- JavaScript for Dynamic Image Preview -->
<script>
    document.getElementById('newImages').addEventListener('change', function(event) {
        const preview = document.getElementById('imagePreview');
        preview.innerHTML = ''; // Clear current preview
        Array.from(event.target.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.classList.add('img-fluid');
                img.style.maxHeight = '300px';
                img.style.objectFit = 'cover';
                img.style.marginBottom = '10px';
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        });
    });
</script>
</body>
</html>
