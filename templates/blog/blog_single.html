{% load static %}
<!doctype html>
<html lang="en">
{% include 'expendable/head.html' %}

<body id="top">
{% include 'expendable/chatbot_and_loading.html' %}

<div class="site-wrap">

    <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
            <div class="site-mobile-menu-close mt-3">
                <span class="icon-close2 js-menu-toggle"></span>
            </div>
        </div>
        <div class="site-mobile-menu-body"></div>
    </div> <!-- .site-mobile-menu -->


    <!-- NAVBAR -->
    {% include 'expendable/navbar.html' %}
    <!-- HOME -->
    <section class="section-hero overlay inner-page bg-image"
             style="background-image: url('{% static 'images/hero_1.jpg' %}');"
             id="home-section">
        <div class="container">
            <div class="row">
                <div class="col-md-7">
                    <h1 class="text-white font-weight-bold">{{ blog.title }}</h1>
                    <div class="custom-breadcrumbs">
                        <a href="#">Home</a> <span class="mx-2 slash">/</span>
                        <a href="{% url 'blog' %}">Blogs</a> <span class="mx-2 slash">/</span>
                        <span class="text-white"><strong>{{ blog.title }}</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="site-section">
        <div class="container">
            <div class="row mb-5">
                <div class="col-lg-8 mb-4 mb-lg-0">
                    <!-- Blog Image -->
                    <div class="d-flex align-items-center mb-4">
                        <div class="border p-2 rounded">
                            {% if blog.photo %}
                                <img src="{{ blog.photo.url }}" alt="Blog Image" class="img-fluid rounded"
                                     style="height: 400px; object-fit: cover;">
                            {% else %}
                                <img src="{% static 'images/smartuiu.png' %}" alt="Default Image"
                                     class="img-fluid rounded" style="height: 400px; object-fit: cover;">
                            {% endif %}
                        </div>
                    </div>

                    <!-- Blog Title and Content -->
                    <h1 class="mb-3">{{ blog.title }}</h1>
                    <p class="text-muted">By {{ blog.author.get_full_name }} | Posted
                        on {{ blog.created_at|date:"M d, Y" }}</p>
                    <div class="mb-4">
                        {{ blog.content }}
                    </div>
                </div>

                <div class="col-lg-4">
                    <!-- Author and Blog Information -->
                    <div class="bg-light p-3 border rounded mb-4">
                        <h3 class="text-primary h5 mb-3">About the Author</h3>
                        <p><strong>Name:</strong> {{ blog.author.get_full_name }}</p>
                        <p><strong>Email:</strong> <a href="mailto:{{ blog.author.email }}">{{ blog.author.email }}</a>
                        </p>
                    </div>

                    <div class="bg-light p-3 border rounded">
                        <h3 class="text-primary h5 mb-3">Share This Blog</h3>
                        <div class="social-share">
                            <a href="#" class="btn btn-outline-primary btn-sm"><span class="icon-facebook"></span></a>
                            <a href="#" class="btn btn-outline-info btn-sm"><span class="icon-twitter"></span></a>
                            <a href="#" class="btn btn-outline-secondary btn-sm"><span class="icon-linkedin"></span></a>
                            <a href="#" class="btn btn-outline-danger btn-sm"><span class="icon-pinterest"></span></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <h3 class="h5 mb-4 text-primary">Comments</h3>
                    {% if blog.comments.all %}
                        <ul class="list-unstyled">
                            {% for comment in blog.comments.all %}
                                <li class="mb-4">
                                    <div class="p-3 bg-white border rounded shadow-sm">
                                        <p><strong>{{ comment.author.get_full_name }}</strong></p>
                                        <p class="mb-2">{{ comment.content }}</p>
                                        <p class="text-muted small">Posted on {{ comment.created_at|date:"M d, Y" }}</p>

                                        {% if comment.author == request.user %}
                                            <form method="post" action="{% url 'comment_delete' comment.id %}"
                                                  class="d-inline">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                            </form>
                                        {% endif %}

                                        <!-- Reply Form -->
                                        <form method="post" action="{% url 'blog_single' blog.id %}" class="mt-2">
                                            {% csrf_token %}
                                            <input type="text" name="content" class="form-control mb-2"
                                                   placeholder="Write a reply..."
                                                   style="border-radius: 20px; height: 38px;">
                                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                                            <button type="submit" name="submit_reply"
                                                    class="btn btn-outline-secondary btn-sm">Reply
                                            </button>
                                        </form>

                                        <!-- Display Replies -->
                                        {% if comment.replies.all %}
                                            <ul class="list-unstyled pl-4 mt-3">
                                                {% for reply in comment.replies.all %}
                                                    <li class="mb-2">
                                                        <div class="p-2 bg-light border rounded">
                                                            <p><strong>{{ reply.author.get_full_name }}:</strong></p>
                                                            <p class="mb-1">{{ reply.content }}</p>
                                                            <p class="text-muted small">Posted
                                                                on {{ reply.created_at|date:"M d, Y" }}</p>

                                                            <!-- Delete Button for Reply -->
                                                            {% if reply.author == request.user %}
                                                                <form method="post"
                                                                      action="{% url 'reply_delete' reply.id %}"
                                                                      class="d-inline">
                                                                    {% csrf_token %}
                                                                    <button type="submit" class="btn btn-danger btn-sm">
                                                                        Delete
                                                                    </button>
                                                                </form>
                                                            {% endif %}
                                                        </div>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No comments yet.</p>
                    {% endif %}

                    <!-- Comment Form -->
                    <h4 class="h6 text-primary">Leave a Comment</h4>
                    <form method="post" action="{% url 'blog_single' blog.id %}"
                          class="bg-white p-3 border rounded shadow-sm d-flex align-items-center">
                        {% csrf_token %}
                        <input type="text" name="content" class="form-control me-2" placeholder="Write a comment..."
                               style="border-radius: 20px; height: 38px;">
                        <button type="submit" name="submit_comment" class="btn btn-primary btn-sm ml-3">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    {% include 'expendable/footer.html' %}

</div>

{% include 'expendable/include.html' %}


</body>
</html>