{% load static %}
<!doctype html>
<html lang="en">
{% include 'expendable/head.html' %}

<style>
    /* Global Styles */
    body {
        font-family: 'Arial', sans-serif;
    }

    .btn-primary, .btn-warning {
        border-radius: 25px;
        padding: 10px 20px;
        font-size: 1rem;
        transition: background-color 0.3s ease;
    }

    .btn-primary:hover {
        background-color: #357ABD;
    }

    .btn-warning:hover {
        background-color: #ff9800;
    }

    .section-hero {
        border-bottom-left-radius: 50px;
        border-bottom-right-radius: 50px;
        height: 400px;
        background-size: cover;
        background-position: center;
        background-image: url('{% static 'images/hero_1.jpg' %}');
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .section-hero h1, .section-hero p {
        color: white;
    }

    .section-hero h1 {
        font-size: 3rem;
        font-weight: 700;
    }

    .section-hero p {
        font-size: 1.5rem;
        font-weight: 500;
    }

    /* Form Styles */
    .filter-form {
        margin-top: 20px;
        margin-bottom: 50px;
    }

    .filter-form select, .filter-form button {
        height: 45px;
        font-size: 1.1rem;
    }

    /* Card Styles */
    .card {
        border-radius: 20px;
        margin-bottom: 30px;
        display: flex;
        flex-direction: row;
        height: 220px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
        transform: scale(1.05);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    .card-img-top {
        width: 50%;
        height: 100%;
        object-fit: cover;
    }

    .card-body {
        width: 50%;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .card-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 10px;
    }

    .text-muted {
        font-size: 1rem;
        margin-bottom: 15px;
    }

    /* Event Banner & Details */
    .event-banner {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .event-details {
        margin-top: -100px;
        background-color: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .event-title {
        font-size: 2.5rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 20px;
    }

    .event-meta {
        color: #666;
        font-size: 1.1rem;
    }

    .event-meta strong {
        font-weight: bold;
    }

    .btn-invite {
        background-color: #ff9800;
        color: white;
        border-radius: 25px;
        padding: 10px 30px;
        font-size: 1.3rem;
        margin-top: 20px;
    }

    .btn-invite:hover {
        background-color: #e68900;
    }

    /* Table Styles */
    .registered-users-table {
        margin-top: 30px;
        width: 100%;
        border-collapse: collapse;
    }

    .registered-users-table th, .registered-users-table td {
        padding: 10px;
        text-align: left;
        border: 1px solid #ddd;
    }

    .registered-users-table th {
        background-color: #f8f9fa;
    }

    /* Footer CTA Section */
    .cta-section {
        padding: 50px 0;
        background-image: url('{% static 'images/hero_1.jpg' %}');
        background-size: cover;
        background-position: center;
        color: white;
        text-align: center;
    }

    .cta-section h2 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
    }

    .cta-section p {
        font-size: 1.2rem;
        margin-bottom: 20px;
    }

    /* Spacing */
    .mt-5 {
        margin-top: 5rem !important;
    }

    .mb-12 {
        margin-bottom: 12px;
    }
</style>

<body id="top">
{% include 'expendable/chatbot_and_loading.html' %}

<div class="site-wrap">
    {% include 'expendable/navbar.html' %}

    <!-- Hero Section -->
    <section class="section-hero overlay inner-page bg-image" id="home-section">
        <div class="container">
            <div class="row">
                <div class="col-md-7">
                    <h1 class="text-white font-weight-bold">{{ event.title }}</h1>
                    <div class="custom-breadcrumbs">
                        <a href="{% url 'homepage' %}">Home</a>
                        <span class="mx-2 slash">/</span>
                        <a href="{% url 'event' %}">Events</a>
                        <span class="mx-2 slash">/</span>
                        <span class="text-white"><strong>{{ event.title }}</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Event Details -->
    <div class="container mt-5">
        {% if messages %}
            <div class="alert alert-success">
                {% for message in messages %}
                    <p>{{ message }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <div class="row justify-content-center">
            <div class="col-md-12">
                {% if event.banner %}
                    <img src="{{ event.banner.url }}" alt="{{ event.title }}" class="event-banner">
                {% else %}
                    <img src="{% static 'images/smartuiu.png' %}" alt="Default Banner" class="event-banner">
                {% endif %}
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-10 event-details">
                <h2 class="event-title">{{ event.title }}</h2>
                <p class="event-meta">
                    <strong>Date:</strong> {{ event.date }} <br>
                    <strong>Time:</strong> {{ event.time }} <br>
                    <strong>Location:</strong> {{ event.location }} <br>
                    <strong>Club:</strong> {{ event.get_club_display }}<br><br>
                    <strong>Description:</strong> {{ event.description|linebreaks }}
                </p>

                <!-- Invite All Button -->
                <div class="text-center">
                    <form method="POST" action="{% url 'event_send_email' event.id %}">
                        {% csrf_token %}
                        <button type="submit" name="send_all" class="btn-invite">Send Invitation Email to All</button>
                    </form>
                </div>

                <!-- Registered Users Table -->
                <div class="mt-4">
                    <h3>Registered Users</h3>
                    <table class="registered-users-table">
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for registration in registrations %}
                            <tr>
                                <td>{{ registration.user.get_full_name }}</td>
                                <td>{{ registration.user.email }}</td>
                                <td>
                                    <button type="button" class="btn btn-primary btn-sm"
                                            data-toggle="modal" data-target="#emailModal"
                                            onclick="populateEmailModal('{{ registration.user.id }}', '{{ registration.user.first_name }}', '{{ registration.user.last_name }}')">
                                        Email
                                    </button>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="3" class="text-center">No users registered for this event.</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                    <!-- Modal for Email Editing -->
                    <div class="modal fade" id="emailModal" tabindex="-1" role="dialog"
                         aria-labelledby="emailModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="emailModalLabel">Edit Email</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="emailForm" method="POST" action="{% url 'event_send_email' event.id %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="user_id" id="emailUserId">
                                        <div class="form-group">
                                            <label for="emailBody">Email Body</label>
                                            <textarea class="form-control" id="emailBody" name="email_body"
                                                      rows="6"></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Send Email</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>

    <!-- Footer CTA -->
    {% include 'expendable/footer.html' %}
</div>

{% include 'expendable/include.html' %}

<script>
    function populateEmailModal(userId, user_first, user_last) {
        document.getElementById('emailUserId').value = userId;
        const defaultMessage = `Dear ${user_first+" "+user_last},\n\nWe are pleased to invite you to the event {{ event.title }}.\nPlease join us on {{ event.date }} at {{ event.time }}.\nLocation: {{ event.location }}.\n\nLooking forward to seeing you there!\n\nBest regards,\n{{ event.get_club_display }} Team`;
        document.getElementById('emailBody').value = defaultMessage;
    }
</script>
</body>
</html>
